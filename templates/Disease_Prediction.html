{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Disease Prediction</title>

  <!-- Bootstrap CSS -->
  <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet"/>
  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet"/>
  <link href="{% static 'Disease_Prediction.css' %}" rel="stylesheet"/>

  <!-- Custom CSS -->

  <style>
  /* Styling for suggested symptoms list */
.suggestions-list .list-group-item {
  background-color: #f8f9fa;
  color: #000;
  border: 1px solid #ddd;
  padding: 10px;
  cursor: pointer;
  transition: background-color 0.3s ease, color 0.3s ease;
}

.suggestions-list .list-group-item:hover {
  background-color:rgb(143, 149, 156);
  color: white;
}
</style>
</head>

<body>

  <!-- Vertical Navbar -->
  <div class="vertical-navbar">
    <div class="logo-section">
      <a href="/"><div class="ms-4 me-4">
        <img src="{% static 'logo2.jpg' %}" alt="Logo" class="icon"/></div>
        <h4>Disease Prediction</h4>
      </a>
    </div>
    <hr/>
    <ul class="nav flex-column" id="navbar">
      <li class="nav-item"><a class="nav-link" href="/"><i class="fas fa-home"></i> Home</a></li>
      <li class="nav-item"><a class="nav-link" href="/Dashboard/"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
      <li class="nav-item"><a class="nav-link active" href="/Disease_Prediction/"><i class="fas fa-diagnoses"></i> Disease Prediction</a></li>
      <li class="nav-item"><a class="nav-link" href="/Report/"><i class="fas fa-file-alt"></i> Report Generation</a></li>
      <li class="nav-item"><a class="nav-link" href="/Blogs/"><i class="fas fa-blog"></i> Health Blogs</a></li>
      <hr/>
      <li class="nav-item"><a class="nav-link" href="/Profile_Management/"><i class="fas fa-user-circle"></i> Profile Management</a></li>
      <li class="nav-item"><a class="nav-link" href="/User_Data/"><i class="fas fa-database"></i> User Data</a></li>
      <li class="nav-item"><a class="nav-link" href="/chatbot/"><i class="fas fa-comments"></i> Chatbot</a></li>
      <li class="nav-item"><a class="nav-link" href="/Logout/"><i class="fas fa-sign-out-alt"></i> Logout</a></li>

    </ul>
  </div>

  <!-- Main Content -->
  <div class="content-container">
    <div class="container py-5">

      <!-- Form Card -->
      <div class="card mx-auto dp-card shadow-sm">
        <div class="card-header bg-primary text-white text-center">
          <h3 class="mb-0"><i class="fas fa-stethoscope me-2"></i>Disease Prediction</h3>
        </div>
        <div class="card-body">
          <form method="post" autocomplete="off">
            {% csrf_token %}
            <div class="mb-4 position-relative">
              <label for="symptoms" class="form-label d-flex align-items-center" style="gap: 8px;">
                Enter Symptoms
                <button type="button" class="btn btn-sm btn-outline-primary rounded-circle p-0 d-flex align-items-center justify-content-center ms-1" 
                  data-bs-toggle="tooltip" data-bs-placement="right" title="Add 4-5 symptoms for accurate results">
                  <span style="font-size: 1.1em; font-weight: bold; width: 1.7em; height: 1.7em; display: flex; align-items: center; justify-content: center;">?</span>
                </button>
              </label>
              <div class="form-text text-primary mb-2 ms-1" style="font-size: 0.98em;">
                <i class="fas fa-info-circle me-1"></i>For best results, enter 4-5 symptoms separated by commas.
              </div>
              <div class="input-group input-group-lg">
                <span class="input-group-text"><i class="fas fa-notes-medical"></i></span>
                <input
                  type="text"
                  id="symptoms"
                  name="symptoms"
                  class="form-control"
                  placeholder="e.g. itching, headache, nausea"
                />
              </div>
              <ul id="suggestions" class="list-group suggestions-list"></ul>
            </div>

            {% if error %}
              <div class="alert alert-danger">{{ error }}</div>
            {% endif %}

            <div class="d-grid">
              <button type="submit" class="btn btn-lg btn-primary dp-btn">
                <i class="fas fa-search me-2"></i> Predict
              </button>
            </div>
          </form>
        </div>
      </div>

      {% if result_ready %}
      <!-- Result Card -->
      <div class="row justify-content-center mt-5">
        <div class="col-md-6">
          <div class="card dp-result-card shadow-sm text-center">
            <div class="card-body">
              <h5 class="card-title text-primary">
                <i class="fas fa-file-medical-alt me-2"></i> Predicted Disease
              </h5>
              <p class="card-text fs-4 fw-semibold">{{ pred }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="row justify-content-center mt-4 gx-3">
        <div class="col-auto mb-3">
          <button class="btn btn-info" data-bs-toggle="modal" data-bs-target="#descriptionModal">
            <i class="fas fa-align-left me-1"></i> Description
          </button>
        </div>
        <div class="col-auto mb-3">
          <button class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#precautionModal">
            <i class="fas fa-exclamation-triangle me-1"></i> Precaution
          </button>
        </div>
        <div class="col-auto mb-3">
          <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#medicationsModal">
            <i class="fas fa-pills me-1"></i> Medications
          </button>
        </div>
        <div class="col-auto mb-3">
          <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#workoutsModal">
            <i class="fas fa-dumbbell me-1"></i> Workouts
          </button>
        </div>
        <div class="col-auto mb-3">
          <button class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#dietsModal">
            <i class="fas fa-utensils me-1"></i> Diets
          </button>
        </div>
      </div>
      {% endif %}

    </div>
  </div>

   <!-- Modals -->
  <div class="modal fade" id="descriptionModal" tabindex="-1" aria-labelledby="descriptionModalLabel" aria-hidden="true">
    <div class="modal-dialog"><div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 id="descriptionModalLabel" class="modal-title">Description</h5>
        <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">{% if dis_des %}<p>{{ dis_des }}</p>{% endif %}</div>
    </div></div>
  </div>

  <div class="modal fade" id="precautionModal" tabindex="-1" aria-labelledby="precautionModalLabel" aria-hidden="true">
    <div class="modal-dialog"><div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 id="precautionModalLabel" class="modal-title">Precaution</h5>
        <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <ul class="list-unstyled">
          {% for item in dis_pre %}<li>{{ item }}</li>{% endfor %}
        </ul>
      </div>
    </div></div>
  </div>

  <div class="modal fade" id="medicationsModal" tabindex="-1" aria-labelledby="medicationsModalLabel" aria-hidden="true">
    <div class="modal-dialog"><div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 id="medicationsModalLabel" class="modal-title">Medications</h5>
        <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <ul class="list-unstyled">
          {% for item in dis_med %}<li>{{ item }}</li>{% endfor %}
        </ul>
      </div>
    </div></div>
  </div>

  <div class="modal fade" id="workoutsModal" tabindex="-1" aria-labelledby="workoutsModalLabel" aria-hidden="true">
    <div class="modal-dialog"><div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 id="workoutsModalLabel" class="modal-title">Workouts</h5>
        <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <ul class="list-unstyled">
          {% for item in dis_workout %}<li>{{ item }}</li>{% endfor %}
        </ul>
      </div>
    </div></div>
  </div>

  <div class="modal fade" id="dietsModal" tabindex="-1" aria-labelledby="dietsModalLabel" aria-hidden="true">
    <div class="modal-dialog"><div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 id="dietsModalLabel" class="modal-title">Diets</h5>
        <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <ul class="list-unstyled">
          {% for item in dis_diet %}<li>{{ item }}</li>{% endfor %}
        </ul>
      </div>
    </div></div>
  </div>

  



  <!-- Bootstrap JS -->
  <script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
  <script>
    // Initialize all tooltips on the page
    document.addEventListener('DOMContentLoaded', function () {
      var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
      tooltipTriggerList.forEach(function (tooltipTriggerEl) {
        new bootstrap.Tooltip(tooltipTriggerEl);
      });
    });
  </script>
  <!-- Autocomplete JS -->
  <script>
    const input = document.getElementById('symptoms');
    const suggestions = document.getElementById('suggestions');

    input.addEventListener('input', () => {
      const raw = input.value;
      const parts = raw.split(',');
      const last = parts[parts.length - 1].trim();
      if (!last) {
        suggestions.innerHTML = '';
        return;
      }
      fetch(`/autocomplete/?letter=${encodeURIComponent(last)}`)
        .then(res => res.json())
        .then(data => {
          suggestions.innerHTML = '';
          data.forEach(symptom => {
            const li = document.createElement('li');
            li.textContent = symptom;
            li.classList.add('list-group-item');
            li.addEventListener('click', () => {
              parts.pop();
              parts.push(symptom);
              input.value = parts.join(', ') + ', ';
              suggestions.innerHTML = '';
            });
            suggestions.appendChild(li);
          });
        });
    });

    document.addEventListener('click', e => {
      if (!input.contains(e.target) && !suggestions.contains(e.target)) {
        suggestions.innerHTML = '';
      }
    });
  </script>
</body>
</html>
